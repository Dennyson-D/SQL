SELECT DENSE_RANK()OVER(/*PARTITION BY IND*/ ORDER BY VERIFICADOR ASC)-1 AS QTD_ACORDOS, BB.* FROM

(
 SELECT AA.*,RIGHT(CODESP,2) CODAA
,CASE RIGHT(CODESP,2) WHEN '2A' THEN CONVERT(VARCHAR,IND)+'2A' ELSE '0' END AS VERIFICADOR

 FROM
(
	SELECT DISTINCT B.IDACORDO,A.IDLAN,A.NUMERODOCUMENTO,A.CLASSIFICACAO CLASFLAN,B.CLASSIFICACAO CLASSACORDO,A.STATUSLAN,A.MESDECOMPETENCIA,A.VALORORIGINAL,A.VALORBAIXADO,A.CODCFO ,
	CASE WHEN A.CLASSIFICACAO = 15 THEN B.IDACORDO ELSE 0 END IND
	,E.IDPARCELA, E.TIPOPARCELA ,E.PARCELA
	,CONVERT(VARCHAR,B.IDACORDO)+CONVERT(VARCHAR,B.CLASSIFICACAO)+E.TIPOPARCELA CODESP
	,B.RECCREATEDON
	
	FROM FLAN A
	JOIN FACORDOREL B ON (B.IDLAN=A.IDLAN)
	JOIN FACORDO C ON (C.IDACORDO=B.IDACORDO)
	JOIN SLAN D ON (D.IDLAN = A.IDLAN)
	JOIN SPARCELA E ON (E.IDPARCELA=D.IDPARCELA)
	WHERE B.IDACORDO IN (39525)
	/*A.IDLAN IN (1455049,
	1455052,
	1467812,
	1467813,
	1477429,
	1477430,
	1487878,
	1498121,
	1508355,
	1508356,
	1518522,
	1522320,
	1541003,1541004,1541005,1541006,1541007,1541008,1541009) */ --(1532189,1478709)  -- CLASSIFICAÇÃO 0,15  HISTORICO
)AA
 )BB 
--WHERE 



--select * from FACORDOrel where idacordo in (39524 ,39525)

-- numerodocumento, perletivo, parcela  

--SELECT * FROM GCAMPOS WHERE TABELA='SPARCELA'